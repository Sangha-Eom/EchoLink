----------------
다음 단계: 안드로이드 클라이언트 개발 시작

이제 "Client/구현 할 기능.txt" 와 "방향성(Client).txt" 파일에 계획하신 대로, 안드로이드 앱 개발을 시작하겠습니다. 전체 과정은 크게 **UI 구성, 인증, 스트리밍, 원격 제어**의 네 단계로 나뉩니다.

#### **1단계: 프로젝트 생성 및 기본 화면 구성**

가장 먼저 안드로이드 스튜디오에서 새 프로젝트를 만들고, 사용자가 보게 될 기본 화면을 구성합니다.

1.  **새 프로젝트 생성:**

      * Android Studio를 열고 'New Project' \> 'Empty Views Activity' 템플릿을 선택합니다.
      * 언어는 **Java** 또는 **Kotlin** 중 편한 것을 선택합니다.

2.  **라이브러리 추가 (`build.gradle` 파일):**

      * **ExoPlayer:** 비디오/오디오 스트림을 쉽게 재생하기 위한 Google의 공식 라이브러리입니다. UDP 스트림을 직접 처리하는 것보다 훨씬 안정적이고 간단합니다.
      * **OkHttp/Retrofit:** 향후 인증 서버나 다른 웹 API와 통신할 때 유용한 HTTP 클라이언트 라이브러리입니다.

3.  **기본 UI 레이아웃 (`activity_main.xml`):**

      * **`PlayerView`**: ExoPlayer와 연동하여 서버로부터 받은 화면 스트림을 여기에 그려줍니다.
      * **로그인/연결 버튼**: 인증을 시작하고 서버에 연결하는 버튼입니다.

    **`activity_main.xml` 예시 코드:**

    ```xml
    <androidx.constraintlayout.widget.ConstraintLayout ...>

        <androidx.media3.ui.PlayerView
            android:id="@+id/player_view"
            android:layout_width="match_parent"
            android:layout_height="match_parent"/>

        <Button
            android:id="@+id/connect_button"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Google 계정으로 로그인"
            ... />

    </androidx.constraintlayout.widget.ConstraintLayout>
    ```

-----

#### **2단계: 클라이언트 인증 구현 (가장 먼저 할 일)**

사용자가 "Google 계정으로 로그인" 버튼을 눌렀을 때, 우리가 만든 인증 웹 서버(`http://localhost:8080`)를 통해 JWT를 발급받는 과정을 구현합니다.

1.  **웹뷰(WebView)로 인증 서버 열기:**

      * 'Google 계정으로 로그인' 버튼 클릭 시, 앱 내에서 \*\*웹뷰(WebView)\*\*를 띄워 인증 서버의 주소(`http://데스크톱PC의_IP:8080`)를 로드합니다.

2.  **JWT 수신 및 저장:**

      * 사용자가 웹뷰 안에서 성공적으로 로그인하면, 서버의 `OAuth2SuccessHandler`는 `.../login/success?token=JWT값` 형태의 URL로 리디렉션합니다.
      * 안드로이드의 `WebViewClient`에서 `shouldOverrideUrlLoading` 메소드를 오버라이드하여, URL이 `/login/success`로 변경되는 것을 감지(Intercept)해야 합니다.
      * 해당 URL에서 `token` 파라미터 값을 추출하여 안드로이드 기기의 안전한 저장소(예: `SharedPreferences`)에 저장합니다.

-----

#### **3. 3단계: 스트리밍 서버 접속 및 제어**

JWT를 성공적으로 저장했다면, 이제 실제 스트리밍 서버에 접속합니다.

1.  **서버 접속:**

      * 백그라운드 스레드에서 데스크톱 서버의 IP와 포트(`20805`)로 TCP 소켓 연결을 시도합니다.
      * 연결 성공 후, 가장 먼저 저장해 둔 JWT를 JSON 형식(`{"jwt":"..."}`)으로 서버(`ClientHandler`)에 전송합니다.

2.  **스트리밍 시작:**

      * 서버로부터 "OK" 응답을 받으면, 사용자가 설정한 해상도, FPS 등의 정보를 JSON으로 전송합니다.
      * ExoPlayer를 설정하여 클라이언트가 받을 UDP 포트(예: `udp://0.0.0.0:12345`)를 리스닝하도록 하고 재생을 시작합니다.

3.  **원격 제어:**

      * `PlayerView`에 `OnTouchListener`를 설정하여 사용자의 터치 이벤트를 감지합니다.
      * 감지된 좌표와 액션(Down, Move, Up)을 서버의 `InputEventReceiver`가 이해할 수 있는 JSON 형식(`{"type":"MOUSE_MOVE", ...}`)으로 변환하여 TCP 소켓으로 전송합니다.

가장 먼저 **1단계와 2단계**를 진행하여, 안드로이드 앱에서 ‘Google로 로그인’ 버튼을 눌러 인증 웹 서버를 열고, 로그인 성공 후 JWT 토큰을 성공적으로 추출하여 저장하는 것부터 시작하시는 것을 추천합니다. 이 과정이 성공하면, 프로젝트의 가장 큰 허들을 넘게 되는 것입니다.
